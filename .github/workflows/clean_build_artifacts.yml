name: Clean build artifacts
on:
  repository_dispatch:
    types: [delete_all_artifacts] # potentially get rid of this since we only want cron job
  schedule:
    - cron: '0 10 * * *' # Once per day at 10am UTC

jobs:
#  main:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Delete artifacts from dispatch
#        if: github.event.action == 'delete_all_artifacts'
#        env:
#          GH_ACTIONS_REPO_TOKEN: ${{ secrets.GH_ACTIONS_REPO_TOKEN }}
#          PARENT_RUN_ID: ${{ github.event.client_payload.parent_run_id  }}
#          PARENT_REPO: ${{ github.event.client_payload.parent_repo }}
#        run: |
#          echo "Running clean build artifacts logic"
#          echo Parent run id: $PARENT_RUN_ID
#          echo Parent repo: $PARENT_REPO
#          curl -X DELETE -H "Authorization: token $GH_ACTIONS_REPO_TOKEN‚Äù https://api.github.com/repos/spring-projects/spring-security/actions/artifacts/123
  main:
    runs-on: ubuntu-latest
    steps:
      - name: Delete artifacts in cron job
        env:
          GH_ACTIONS_REPO_TOKEN: ${{ secrets.GH_ACTIONS_REPO_TOKEN }}
        run: |
          echo "Running clean build artifacts logic"
          output=$(curl -X GET -H "Authorization: token $GH_ACTIONS_REPO_TOKEN" https://api.github.com/repos/spring-projects/spring-security/actions/artifacts | grep '"id"' | cut -d : -f2 | sed 's/,*$//g')
          echo Output is $output
          for id in $output; do curl -X DELETE -H "Authorization: token $GH_ACTIONS_REPO_TOKEN" https://api.github.com/repos/spring-projects/spring-security/actions/artifacts/$id; done;
